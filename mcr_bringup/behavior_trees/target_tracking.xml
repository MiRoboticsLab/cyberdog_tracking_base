<?xml version="1.0"?>
<root main_tree_to_execute="MainTree">
    <!-- ////////// -->
    <BehaviorTree ID="MainTree">
        <Control ID="RecoveryNode" name="TargetTracking" number_of_retries="-1">
            <Control ID="PipelineSequence" name="NavigateWithReplanning">
                <Decorator ID="RateController" hz="5.0">
                    <Sequence>
                        <Action ID="TrackingModeDecider" input_tracking_mode="{relative_pos}" output_tracking_mode="{mode_decided}"/>
                        <Decorator ID="TargetUpdater" input_goal="{goal}" input_tracking_mode="{mode_decided}" transformed_goal="{transformed_goal}" output_goal="{updated_goal}" output_goals="{updated_goals}" output_exception_code="{exception}" >
                            <ReactiveFallback name="ComputePathActions">
                                <Action ID="ComputePathToPose" goal="{transformed_goal}" server_timeout="4000" path="{path}" planner_id="SplinePlanner" start=""/>
                                <Sequence>
                                    <Action ID="ComputePathToPose" goal="{updated_goal}" server_timeout="4000" path="{path_full}" planner_id="PotentialPlanner" start=""/>
                                    <TruncatePath distance="1.0" input_path="{path_full}" output_path="{path}"/>
                                </Sequence>                                
                            </ReactiveFallback>
                        </Decorator>
                    </Sequence>
                </Decorator>
                <KeepRunningUntilFailure>
                    <Action ID="FollowPath" goal_checker_id="xy_goal_checker" controller_id="TrackingTarget" progress_checker_id="fake_progress_checker" path="{path}" server_timeout="1000" />
                </KeepRunningUntilFailure>
            </Control>
            <ReactiveFallback name="RecoveryActions">
                <ExceptionVerify exception_code="{exception}" expected_code="1000">
                    <Action ID="SpinAndSearch" search_dist="1.57" server_timeout="4000"/>
                </ExceptionVerify>
                <ExceptionVerify exception_code="{exception}" expected_code="3000">
                    <Action ID="ClearEntireCostmap" name="ClearEntireGlobalCostmap" service_name="rolling_window_costmap/clear_entirely_rolling_window_costmap"/>
                </ExceptionVerify>
                <ForceSuccess>
                    <ExceptionVerify exception_code="{exception}" expected_code="4000">
                        <Action ID="ClearEntireCostmap" name="ClearEntireLocalCostmap" service_name="local_costmap_tracking/clear_entirely_local_costmap_tracking"/>
                    </ExceptionVerify>                
                </ForceSuccess>
            </ReactiveFallback>
        </Control>
    </BehaviorTree>
</root>    
